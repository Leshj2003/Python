## 堆及堆排序

## 堆

堆是一种**完全二叉树**，分类有**最大堆**和**最小堆**。除了具备完全二叉树的特性外，最大堆的每个节点，都要大于其左右子树上的所有节点；最小堆的每个节点，都要小于其左右子树上的所有节点。要理解堆，就要明白堆是如何插入和删除节点，以及如何创建堆。

## 插入节点

将这些之前，先讲一下堆的存储结构。堆虽然是完全二叉树，但并不是链式存储，而是顺序存储。

例如我们现在给定数组：[ 1, 3, 2, 5, 6, 7, 4 ]（最小堆，接下来都会以该堆为例）

![](D:\Desktop\python\images\0722\1.png)

对于元素1，它的左右子节点为3和2；对于元素3，它的左右子节点为5和6；对于元素2，它的左右子节点为7和4；再之后的元素则没有子节点。由此观察，元素1的索引为0，则其子节点3和2的索引分别为2*0+1和2*0+2；元素3的索引为1，其子节点索引分别为2*1+1和2*1+2。即从堆的存储判断其左右子节点的公式为 **2 \* i + 1 和 2 \* i + 2**（ i 为索引）。

了解了存储结构，我们来看插入节点如何实现。



 



![](D:\Desktop\python\images\0722\2.png)

我们要插入节点0，那首先自然会扩展数组，然后把元素0置于末尾。接下来就要对节点进行**上浮**操作：

1. 将插入的节点与其父节点比较，若小于（因为这里是最小堆）父节点则将其与父节点交换。
2. 重复执行操作1，知道插入的节点大于父节点或者插入节点到达堆顶时，上浮操作完成。

我们来看一下图解过程：

![](D:\Desktop\python\images\0722\3.png)

## 删除节点

将刚才插入的元素0删除，其删除后会将末尾的节点置于堆顶，即节点5置于堆顶。此时发现不满足最小堆的结构于是我们要进行**下沉**操作：

1. 将**需下沉节点**与其左右子节点中比较小的一方交换
2. 重复操作1，直到该节点小于其左右子节点或者该节点已经是叶子节点时，下浮操作完成。



 



图解该过程：

![](D:\Desktop\python\images\0722\4.png)

我们可以看出删除后与最开始的堆是一样的，但其实这只是巧合。

## 创建堆

给出数据：[ 5, 2, 7, 3, 6, 1, 4 ]，创建最小堆：

将其看做完全二叉树：

![](D:\Desktop\python\images\0722\5.png)

从堆顶开始，由于 2 < 5，所以5下沉，2上浮。

![](D:\Desktop\python\images\0722\6.png)

此时 3 < 5，所以5下沉，3上浮。

![](D:\Desktop\python\images\0722\7.png)

再看到 1 < 7，所以7下沉，1上浮。

![](D:\Desktop\python\images\0722\8.png)

最后 1 < 2，所以2下沉，1上浮。![](D:\Desktop\python\images\0722\9.png)